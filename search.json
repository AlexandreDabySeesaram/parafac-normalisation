[
  {
    "objectID": "parafac.html",
    "href": "parafac.html",
    "title": "Parafac normalisation",
    "section": "",
    "text": "This notebook shows how a tensor decomposition can help unfold hidden parametric dependency in order to remove their effect and study other dependencies cleaned from the unwanted effects.\n\n\nHere ww study \\(f\\left(x,y,z\\right) = \\left(x^2 + y^2 \\right) \\times z^2\\). We want to study the dependency of \\(x\\) w.r.t \\(y\\) without being polluted by the effect of \\(z\\).\nTo do so we perform a parafac decompoition :\n\\(f\\left(x,y,z\\right) = \\sum\\limits_{i=1}^2 \\lambda_i^x\\left(x\\right)\\lambda_i^y\\left(y\\right)\\lambda_i^z\\left(z\\right)\\)\nand from there we compute a non-linearly normalised function \\(\\tilde{f}\\) where the effect of \\(z\\) is removed as\n\\(\\tilde{f}\\left(x,y\\right) = \\sum\\limits_{i=1}^2 \\lambda_i^x\\left(x\\right)\\lambda_i^y\\left(y\\right)\\underbrace{\\tilde{\\lambda}_i^z\\left(z\\right)}_{=1}\\)\n\n\n\n    \n    \n    \n    import%20numpy%20as%20np%0Aimport%20matplotlib.pyplot%20as%20plt%0Aimport%20tensorly%20as%20tl%0Afrom%20tensorly.decomposition%20import%20parafac%0Afrom%20tensorly.cp_tensor%20import%20cp_normalize%0A%0Anx%2C%20ny%2C%20nz%20%3D%2060%2C%2060%2C%2040%0Ax%20%3D%20np.linspace(-2%2C%202%2C%20nx)%0Ay%20%3D%20np.linspace(-2%2C%202%2C%20ny)%0Az%20%3D%20np.linspace(1%2C%202%2C%20nz)%0A%0A%0AX%2C%20Y%2C%20Z%20%3D%20np.meshgrid(x%2C%20y%2C%20z%2C%20indexing%3D'ij')%0A%0A%23%20f(x%2Cy%2Cz)%20%3D%20exp(-(x%5E2%20%2B%20y%5E2))%20*%20cos(z)%20%2B%20(x*y)%20*%20sin(z)%0A%23%20data%20%3D%20np.exp(-(X**2%20%2B%20Y**2))%20*%20np.cos(Z)%20%2B%20(X%20*%20Y)%20*%20np.sin(Z)%0A%23data%20%3D%20(X**2%20%2B%20Y**2)%20*%20np.cos(Z)%0Adata%20%3D%20(X**2%20%2B%20Y**2)%20*%20Z**2%0A%0A%0A%0Aprint(f%22shape%20of%20data%20is%20%7Bdata.shape%7D%22)%0A%0Arank%20%3D%202%0Aweights%2C%20modes%20%20%3D%20parafac(data%2C%20rank%3Drank%2C%20init%3D'svd')%0A%0Acp_tensor%20%3D%20cp_normalize((weights%2C%20modes))%0Aweights%2C%20modes%20%3D%20cp_tensor%0A%0A%0Amode_x%2C%20mode_y%2C%20mode_z%20%3D%20modes%0A%23normalised_z%20%3D%20np.ones_like(mode_z)%0A%23breakpoint()%0Anormalised_z%20%3D%20np.sign(mode_z)%20%23%20to%20keep%20the%20sign%0Anormalised_tensor%20%3D%20tl.cp_to_tensor((weights%2C%20%5Bmode_x%2C%20mode_y%2C%20normalised_z%5D))%0Adata_recon_debug%20%3D%20tl.cp_to_tensor((weights%2C%20%5Bmode_x%2C%20mode_y%2C%20mode_z%5D))%0A%0A%23%20%23%20plot%20the%20modes%0A%23%20fig%2C%20axes%20%3D%20plt.subplots(1%2C%203%2C%20figsize%3D(10%2C%204))%0A%0A%23%20%23%20Plot%20X-modes%20(modes%5B0%5D)%0A%23%20axes%5B0%5D.plot(x%2C%20modes%5B0%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B0%5D.plot(x%2C%20modes%5B0%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B0%5D.set_title(%22X-Axis%20Modes%22)%0A%23%20axes%5B0%5D.legend()%0A%0A%23%20%23%20Plot%20Y-modes%20(modes%5B1%5D)%0A%23%20axes%5B1%5D.plot(y%2C%20modes%5B1%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B1%5D.plot(y%2C%20modes%5B1%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B1%5D.set_title(%22Y-Axis%20Modes%22)%0A%23%20axes%5B1%5D.legend()%0A%0A%23%20%23%20Plo2%20Z-modes%20(modes%5B2%5D)%0A%23%20axes%5B2%5D.plot(z%2C%20modes%5B2%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B2%5D.plot(z%2C%20modes%5B2%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B2%5D.set_title(%22Z-Axis%20Modes%22)%0A%23%20axes%5B2%5D.legend()%0A%23%20plt.show()%0A%0Aimport%20marimo%20as%20mo%0Aimport%20plotly.graph_objects%20as%20go%0Afrom%20plotly.subplots%20import%20make_subplots%0A%0A%0A%23%20Create%20the%20subplot%20structure%3A%201%20row%2C%203%20columns%0Afig%20%3D%20make_subplots(%0A%20%20%20%20rows%3D1%2C%20cols%3D3%2C%20%0A%20%20%20%20subplot_titles%3D(%22X-Axis%20Modes%22%2C%20%22Y-Axis%20Modes%22%2C%20%22Z-Axis%20Modes%22)%0A)%0A%0A%23%20Define%20a%20helper%20list%20to%20map%20data%20to%20subplots%0A%23%20(x_data%2C%20mode_data%2C%20column_index)%0Aplot_configs%20%3D%20%5B%0A%20%20%20%20(x%2C%20modes%5B0%5D%2C%201)%2C%0A%20%20%20%20(y%2C%20modes%5B1%5D%2C%202)%2C%0A%20%20%20%20(z%2C%20modes%5B2%5D%2C%203)%0A%5D%0A%0Afor%20x_vals%2C%20mode_vals%2C%20col%20in%20plot_configs%3A%0A%20%20%20%20%23%20Plot%20Component%201%0A%20%20%20%20fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(x%3Dx_vals%2C%20y%3Dmode_vals%5B%3A%2C%200%5D%2C%20name%3Df'Mode%201'%2C%20mode%3D'lines')%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3Dcol%0A%20%20%20%20)%0A%20%20%20%20%23%20Plot%20Component%202%0A%20%20%20%20fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(x%3Dx_vals%2C%20y%3Dmode_vals%5B%3A%2C%201%5D%2C%20name%3Df'Mode%202'%2C%20mode%3D'lines')%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3Dcol%0A%20%20%20%20)%0A%0A%23%20Update%20layout%20for%20sizing%20and%20legend%20behavior%0Afig.update_layout(%0A%20%20%20%20height%3D400%2C%20%0A%20%20%20%20width%3D1000%2C%20%0A%20%20%20%20template%3D%22plotly_white%22%2C%0A%20%20%20%20showlegend%3DTrue%0A)%0A%0A%23%20fig.show()%0A%0Amo.ui.plotly(fig)%0A\n\n\n\n\n\n    \n    \n    \n    %23%20z_slider%20%3D%20mo.ui.slider(%0A%23%20%20%20%20%20start%3D0%2C%20%0A%23%20%20%20%20%20stop%3Dnz%20-%201%2C%20%0A%23%20%20%20%20%20step%3D1%2C%20%0A%23%20%20%20%20%20value%3Dnz%20%2F%2F%202%2C%20%0A%23%20%20%20%20%20label%3D%22Z-Slice%20Index%22%2C%20%0A%23%20)%0A%0A%0Az_slider%20%3D%20mo.ui.slider(0%2C%20nz%20-%201%2C%201%2C%20label%3D%22z-slice%20Index%22%2C%20show_value%3DTrue%2C%20include_input%3DTrue%2C%20value%20%3D%20nz%20%2F%2F%202)%0A%0Az_slider\n\n\n    \n    \n    \n    def%20render_3d_slices(z_idx)%3A%0A%20%20%20%20%0A%20%20%20%20v_min%20%3D%20min(data_recon_debug.min()%2C%20normalised_tensor.min())%0A%20%20%20%20v_max%20%3D%20max(data_recon_debug.max()%2C%20normalised_tensor.max())%0A%0A%20%20%20%20v_max_recon%20%3D%20data_recon_debug.max()%0A%20%20%20%20v_min_recon%20%3D%20data_recon_debug.min()%0A%20%20%20%20%0A%20%20%20%20v_max_normalised%20%3D%20normalised_tensor.max()%0A%20%20%20%20v_min_normalised%20%3D%20normalised_tensor.min()%0A%20%20%20%20%0A%20%20%20%20slice_orig%20%3D%20data_recon_debug%5B%3A%2C%20%3A%2C%20z_idx%5D%0A%20%20%20%20slice_clean%20%3D%20normalised_tensor%5B%3A%2C%20%3A%2C%20z_idx%5D%0A%0A%20%20%20%20print(f%22mean%20slice_orig%20%3A%20%7Bslice_orig.mean()%7D%22)%0A%20%20%20%20print(f%22mean%20slice_clean%20%3A%20%7Bslice_clean.mean()%7D%22)%0A%20%20%20%20%0A%20%20%20%20print(f%22v_max_recon%20%3A%20%7Bv_max_recon%7D%22)%0A%20%20%20%20print(f%22v_min_recon%20%3A%20%7Bv_min_recon%7D%22)%0A%20%20%20%20print(f%22v_max_normalised%20%3A%20%7Bv_max_normalised%7D%22)%0A%20%20%20%20print(f%22v_min_normalised%20%3A%20%7Bv_min_normalised%7D%22)%0A%20%20%20%20%0A%0A%20%20%20%20plane_z%20%3D%20np.full(slice_orig.shape%2C%20z_idx)%0A%20%20%20%20fig_3%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D1%2C%20cols%3D2%2C%0A%20%20%20%20%20%20%20%20specs%3D%5B%5B%7B'type'%3A%20'surface'%7D%2C%20%7B'type'%3A%20'surface'%7D%5D%5D%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3D(%22Original%20slice%20%22%2C%20%22Normalised%20slice%20%22)%0A%20%20%20%20)%0A%0A%20%0A%20%20%20%20fig_3.add_trace(%0A%20%20%20%20%20%20%20%20go.Surface(%0A%20%20%20%20%20%20%20%20%20%20%20%20z%3Dplane_z%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20surfacecolor%3Dslice_orig%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Viridis'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20cmin%3Dv_min_recon%2C%20cmax%3Dv_max_recon%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20cmin%3D0%2C%20cmax%3D10%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20showscale%3DFalse%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%0A%20%20%20%20fig_3.add_trace(%0A%20%20%20%20%20%20%20%20go.Surface(%0A%20%20%20%20%20%20%20%20%20%20%20%20z%3Dplane_z%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20surfacecolor%3Dslice_clean%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Viridis'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20cmin%3Dv_min_normalised%2C%20cmax%3Dv_max_normalised%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20colorbar_title%3D%22Value%22%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D2%0A%20%20%20%20)%0A%0A%0A%20%20%20%20fig_3.update_layout(%0A%20%20%20%20%20%20%20%20height%3D700%2C%0A%20%20%20%20%20%20%20%20width%3D1200%2C%0A%20%20%20%20%20%20%20%20scene%3Ddict(zaxis%3Ddict(range%3D%5B0%2C%20nz%5D))%2C%20%0A%20%20%20%20%20%20%20%20scene2%3Ddict(zaxis%3Ddict(range%3D%5B0%2C%20nz%5D))%2C%0A%20%20%20%20%20%20%20%20margin%3Ddict(l%3D0%2C%20r%3D0%2C%20b%3D0%2C%20t%3D40)%0A%20%20%20%20)%0A%0A%20%20%20%20return%20fig_3%0A%0A%0Amo.ui.plotly(render_3d_slices(z_slider.value))%0A%0A%0A%23%20mo.vstack(%5B%0A%23%20%20%20%20%20z_slider%2C%0A%23%20%20%20%20%20render_3d_slices(z_slider.value)%0A%23%20%5D)%0A%0A"
  },
  {
    "objectID": "parafac.html#exemple",
    "href": "parafac.html#exemple",
    "title": "Parafac normalisation",
    "section": "",
    "text": "Here ww study \\(f\\left(x,y,z\\right) = \\left(x^2 + y^2 \\right) \\times z^2\\). We want to study the dependency of \\(x\\) w.r.t \\(y\\) without being polluted by the effect of \\(z\\).\nTo do so we perform a parafac decompoition :\n\\(f\\left(x,y,z\\right) = \\sum\\limits_{i=1}^2 \\lambda_i^x\\left(x\\right)\\lambda_i^y\\left(y\\right)\\lambda_i^z\\left(z\\right)\\)\nand from there we compute a non-linearly normalised function \\(\\tilde{f}\\) where the effect of \\(z\\) is removed as\n\\(\\tilde{f}\\left(x,y\\right) = \\sum\\limits_{i=1}^2 \\lambda_i^x\\left(x\\right)\\lambda_i^y\\left(y\\right)\\underbrace{\\tilde{\\lambda}_i^z\\left(z\\right)}_{=1}\\)\n\n\n\n    \n    \n    \n    import%20numpy%20as%20np%0Aimport%20matplotlib.pyplot%20as%20plt%0Aimport%20tensorly%20as%20tl%0Afrom%20tensorly.decomposition%20import%20parafac%0Afrom%20tensorly.cp_tensor%20import%20cp_normalize%0A%0Anx%2C%20ny%2C%20nz%20%3D%2060%2C%2060%2C%2040%0Ax%20%3D%20np.linspace(-2%2C%202%2C%20nx)%0Ay%20%3D%20np.linspace(-2%2C%202%2C%20ny)%0Az%20%3D%20np.linspace(1%2C%202%2C%20nz)%0A%0A%0AX%2C%20Y%2C%20Z%20%3D%20np.meshgrid(x%2C%20y%2C%20z%2C%20indexing%3D'ij')%0A%0A%23%20f(x%2Cy%2Cz)%20%3D%20exp(-(x%5E2%20%2B%20y%5E2))%20*%20cos(z)%20%2B%20(x*y)%20*%20sin(z)%0A%23%20data%20%3D%20np.exp(-(X**2%20%2B%20Y**2))%20*%20np.cos(Z)%20%2B%20(X%20*%20Y)%20*%20np.sin(Z)%0A%23data%20%3D%20(X**2%20%2B%20Y**2)%20*%20np.cos(Z)%0Adata%20%3D%20(X**2%20%2B%20Y**2)%20*%20Z**2%0A%0A%0A%0Aprint(f%22shape%20of%20data%20is%20%7Bdata.shape%7D%22)%0A%0Arank%20%3D%202%0Aweights%2C%20modes%20%20%3D%20parafac(data%2C%20rank%3Drank%2C%20init%3D'svd')%0A%0Acp_tensor%20%3D%20cp_normalize((weights%2C%20modes))%0Aweights%2C%20modes%20%3D%20cp_tensor%0A%0A%0Amode_x%2C%20mode_y%2C%20mode_z%20%3D%20modes%0A%23normalised_z%20%3D%20np.ones_like(mode_z)%0A%23breakpoint()%0Anormalised_z%20%3D%20np.sign(mode_z)%20%23%20to%20keep%20the%20sign%0Anormalised_tensor%20%3D%20tl.cp_to_tensor((weights%2C%20%5Bmode_x%2C%20mode_y%2C%20normalised_z%5D))%0Adata_recon_debug%20%3D%20tl.cp_to_tensor((weights%2C%20%5Bmode_x%2C%20mode_y%2C%20mode_z%5D))%0A%0A%23%20%23%20plot%20the%20modes%0A%23%20fig%2C%20axes%20%3D%20plt.subplots(1%2C%203%2C%20figsize%3D(10%2C%204))%0A%0A%23%20%23%20Plot%20X-modes%20(modes%5B0%5D)%0A%23%20axes%5B0%5D.plot(x%2C%20modes%5B0%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B0%5D.plot(x%2C%20modes%5B0%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B0%5D.set_title(%22X-Axis%20Modes%22)%0A%23%20axes%5B0%5D.legend()%0A%0A%23%20%23%20Plot%20Y-modes%20(modes%5B1%5D)%0A%23%20axes%5B1%5D.plot(y%2C%20modes%5B1%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B1%5D.plot(y%2C%20modes%5B1%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B1%5D.set_title(%22Y-Axis%20Modes%22)%0A%23%20axes%5B1%5D.legend()%0A%0A%23%20%23%20Plo2%20Z-modes%20(modes%5B2%5D)%0A%23%20axes%5B2%5D.plot(z%2C%20modes%5B2%5D%5B%3A%2C%200%5D%2C%20label%3D'Comp%201%20')%0A%23%20axes%5B2%5D.plot(z%2C%20modes%5B2%5D%5B%3A%2C%201%5D%2C%20label%3D'Comp%202%20')%0A%23%20axes%5B2%5D.set_title(%22Z-Axis%20Modes%22)%0A%23%20axes%5B2%5D.legend()%0A%23%20plt.show()%0A%0Aimport%20marimo%20as%20mo%0Aimport%20plotly.graph_objects%20as%20go%0Afrom%20plotly.subplots%20import%20make_subplots%0A%0A%0A%23%20Create%20the%20subplot%20structure%3A%201%20row%2C%203%20columns%0Afig%20%3D%20make_subplots(%0A%20%20%20%20rows%3D1%2C%20cols%3D3%2C%20%0A%20%20%20%20subplot_titles%3D(%22X-Axis%20Modes%22%2C%20%22Y-Axis%20Modes%22%2C%20%22Z-Axis%20Modes%22)%0A)%0A%0A%23%20Define%20a%20helper%20list%20to%20map%20data%20to%20subplots%0A%23%20(x_data%2C%20mode_data%2C%20column_index)%0Aplot_configs%20%3D%20%5B%0A%20%20%20%20(x%2C%20modes%5B0%5D%2C%201)%2C%0A%20%20%20%20(y%2C%20modes%5B1%5D%2C%202)%2C%0A%20%20%20%20(z%2C%20modes%5B2%5D%2C%203)%0A%5D%0A%0Afor%20x_vals%2C%20mode_vals%2C%20col%20in%20plot_configs%3A%0A%20%20%20%20%23%20Plot%20Component%201%0A%20%20%20%20fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(x%3Dx_vals%2C%20y%3Dmode_vals%5B%3A%2C%200%5D%2C%20name%3Df'Mode%201'%2C%20mode%3D'lines')%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3Dcol%0A%20%20%20%20)%0A%20%20%20%20%23%20Plot%20Component%202%0A%20%20%20%20fig.add_trace(%0A%20%20%20%20%20%20%20%20go.Scatter(x%3Dx_vals%2C%20y%3Dmode_vals%5B%3A%2C%201%5D%2C%20name%3Df'Mode%202'%2C%20mode%3D'lines')%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3Dcol%0A%20%20%20%20)%0A%0A%23%20Update%20layout%20for%20sizing%20and%20legend%20behavior%0Afig.update_layout(%0A%20%20%20%20height%3D400%2C%20%0A%20%20%20%20width%3D1000%2C%20%0A%20%20%20%20template%3D%22plotly_white%22%2C%0A%20%20%20%20showlegend%3DTrue%0A)%0A%0A%23%20fig.show()%0A%0Amo.ui.plotly(fig)%0A\n\n\n\n\n\n    \n    \n    \n    %23%20z_slider%20%3D%20mo.ui.slider(%0A%23%20%20%20%20%20start%3D0%2C%20%0A%23%20%20%20%20%20stop%3Dnz%20-%201%2C%20%0A%23%20%20%20%20%20step%3D1%2C%20%0A%23%20%20%20%20%20value%3Dnz%20%2F%2F%202%2C%20%0A%23%20%20%20%20%20label%3D%22Z-Slice%20Index%22%2C%20%0A%23%20)%0A%0A%0Az_slider%20%3D%20mo.ui.slider(0%2C%20nz%20-%201%2C%201%2C%20label%3D%22z-slice%20Index%22%2C%20show_value%3DTrue%2C%20include_input%3DTrue%2C%20value%20%3D%20nz%20%2F%2F%202)%0A%0Az_slider\n\n\n    \n    \n    \n    def%20render_3d_slices(z_idx)%3A%0A%20%20%20%20%0A%20%20%20%20v_min%20%3D%20min(data_recon_debug.min()%2C%20normalised_tensor.min())%0A%20%20%20%20v_max%20%3D%20max(data_recon_debug.max()%2C%20normalised_tensor.max())%0A%0A%20%20%20%20v_max_recon%20%3D%20data_recon_debug.max()%0A%20%20%20%20v_min_recon%20%3D%20data_recon_debug.min()%0A%20%20%20%20%0A%20%20%20%20v_max_normalised%20%3D%20normalised_tensor.max()%0A%20%20%20%20v_min_normalised%20%3D%20normalised_tensor.min()%0A%20%20%20%20%0A%20%20%20%20slice_orig%20%3D%20data_recon_debug%5B%3A%2C%20%3A%2C%20z_idx%5D%0A%20%20%20%20slice_clean%20%3D%20normalised_tensor%5B%3A%2C%20%3A%2C%20z_idx%5D%0A%0A%20%20%20%20print(f%22mean%20slice_orig%20%3A%20%7Bslice_orig.mean()%7D%22)%0A%20%20%20%20print(f%22mean%20slice_clean%20%3A%20%7Bslice_clean.mean()%7D%22)%0A%20%20%20%20%0A%20%20%20%20print(f%22v_max_recon%20%3A%20%7Bv_max_recon%7D%22)%0A%20%20%20%20print(f%22v_min_recon%20%3A%20%7Bv_min_recon%7D%22)%0A%20%20%20%20print(f%22v_max_normalised%20%3A%20%7Bv_max_normalised%7D%22)%0A%20%20%20%20print(f%22v_min_normalised%20%3A%20%7Bv_min_normalised%7D%22)%0A%20%20%20%20%0A%0A%20%20%20%20plane_z%20%3D%20np.full(slice_orig.shape%2C%20z_idx)%0A%20%20%20%20fig_3%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D1%2C%20cols%3D2%2C%0A%20%20%20%20%20%20%20%20specs%3D%5B%5B%7B'type'%3A%20'surface'%7D%2C%20%7B'type'%3A%20'surface'%7D%5D%5D%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3D(%22Original%20slice%20%22%2C%20%22Normalised%20slice%20%22)%0A%20%20%20%20)%0A%0A%20%0A%20%20%20%20fig_3.add_trace(%0A%20%20%20%20%20%20%20%20go.Surface(%0A%20%20%20%20%20%20%20%20%20%20%20%20z%3Dplane_z%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20surfacecolor%3Dslice_orig%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Viridis'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20cmin%3Dv_min_recon%2C%20cmax%3Dv_max_recon%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20cmin%3D0%2C%20cmax%3D10%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20showscale%3DFalse%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%0A%20%20%20%20fig_3.add_trace(%0A%20%20%20%20%20%20%20%20go.Surface(%0A%20%20%20%20%20%20%20%20%20%20%20%20z%3Dplane_z%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20surfacecolor%3Dslice_clean%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Viridis'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20cmin%3Dv_min_normalised%2C%20cmax%3Dv_max_normalised%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20colorbar_title%3D%22Value%22%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D2%0A%20%20%20%20)%0A%0A%0A%20%20%20%20fig_3.update_layout(%0A%20%20%20%20%20%20%20%20height%3D700%2C%0A%20%20%20%20%20%20%20%20width%3D1200%2C%0A%20%20%20%20%20%20%20%20scene%3Ddict(zaxis%3Ddict(range%3D%5B0%2C%20nz%5D))%2C%20%0A%20%20%20%20%20%20%20%20scene2%3Ddict(zaxis%3Ddict(range%3D%5B0%2C%20nz%5D))%2C%0A%20%20%20%20%20%20%20%20margin%3Ddict(l%3D0%2C%20r%3D0%2C%20b%3D0%2C%20t%3D40)%0A%20%20%20%20)%0A%0A%20%20%20%20return%20fig_3%0A%0A%0Amo.ui.plotly(render_3d_slices(z_slider.value))%0A%0A%0A%23%20mo.vstack(%5B%0A%23%20%20%20%20%20z_slider%2C%0A%23%20%20%20%20%20render_3d_slices(z_slider.value)%0A%23%20%5D)%0A%0A"
  },
  {
    "objectID": "index.html#example-of-marimo-in-quarto",
    "href": "index.html#example-of-marimo-in-quarto",
    "title": "Marimo-quarto",
    "section": "Example of marimo in quarto",
    "text": "Example of marimo in quarto\nHere you can run python directly within your browser thanks to WASM to compute the salary of french civil servant depending on the “indice majoré” (IM). A big thank you to the awesome pluggin quarto-marimo enabling marimo to natively within quarto\nhere you’ll find\n\nAn parafac-normalisation"
  }
]